<?php
//
class ESSBAddonsHelper {

	private $cache_options_slug = "essb3_addons";
	private $announced_addons_slug = "essb3_addons_announce";
	private $update_addons_server = "http://extensions.appscreo.com/4/"; //"http://addons.appscreo.com";

	private $base_addons = 'eyJlc3NiLWJpbWJlci1leHRlbnNpb24iOnsic2x1ZyI6ImVzc2ItYmltYmVyLWV4dGVuc2lvbiIsIm5hbWUiOiJEaXNwbGF5IE1ldGhvZDogQmltYmVyIFRoZW1lIFNoYXJlIEJ1dHRvbnMgUmVwbGFjZSIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wNi5wbmciLCJkZXNjcmlwdGlvbiI6IkluY2x1ZGUgcmVwbGFjZW1lbnQgb2YgZGVmYXVsdCB0aGVtZSBzaGFyZSBidXR0b25zIHdpdGggRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyAodGhlbWUgc3BlY2lmaWMgZnVuY3Rpb25zKSIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWJpbWJlci1leHRlbnNpb24iLCJkZW1vX3VybCI6IiIsImNoZWNrIjoiRVNTQl9CSU1CRVJfUkVQTEFDRSIsInRhZ3MiOiJuZXciLCJjYXRlZ29yeSI6ImludGVncmF0aW9uIiwicmVxdWlyZXMiOiI0LjEuOCIsImZpbHRlcnMiOiJkaXNwbGF5LG5ldyxmcmVlLGludGVncmF0aW9uIn0sImVzc2ItZGlzcGxheS13b29jb21tZXJjZXRoYW5reW91Ijp7InNsdWciOiJlc3NiLWRpc3BsYXktd29vY29tbWVyY2V0aGFua3lvdSIsIm5hbWUiOiJEaXNwbGF5IE1ldGhvZDogV29vQ29tbWVyY2UgVGhhbmsgWW91IFBhZ2UgU2hhcmUgUHJvZHVjdHMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2V4dGVuc2lvbnMtMDMucG5nIiwiZGVzY3JpcHRpb24iOiJBZGQgbGlzdCBvZiBwdXJjaGFzZWQgcHJvZHVjdHMgd2l0aCBzaGFyZSBidXR0b25zIG9uIHlvdXIgV29vQ29tbWVyY2UgdGhhbmsgeW91IGFmdGVyIHB1cmNoYXNlIHBhZ2UiLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LXdvb2NvbW1lcmNldGhhbmt5b3UiLCJkZW1vX3VybCI6Imh0dHBzOlwvXC9zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvNTAtc29jaWFsLW5ldHdvcmtzLXNwZWNpYWwtYnV0dG9uc1wvIiwiY2hlY2siOiJFU1NCX0RNX1dUQl9QTFVHSU5fUk9PVCIsInRhZ3MiOiJuZXciLCJjYXRlZ29yeSI6Indvb2NvbW1lcmNlIiwicmVxdWlyZXMiOiI0LjEuOCIsImZpbHRlcnMiOiJkaXNwbGF5LG5ldyxmcmVlLHdvb2NvbW1lcmNlIn0sImVzc2ItZXh0ZW5kZWQtYnV0dG9ucy1wYWNrIjp7InNsdWciOiJlc3NiLWV4dGVuZGVkLWJ1dHRvbnMtcGFjayIsIm5hbWUiOiJTb2NpYWwgTmV0d29ya3M6IEV4dGVuZGVkIFNvY2lhbCBOZXR3b3JrcyBQYWNrIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9leHRlbnNpb25zLTAyLnBuZyIsImRlc2NyaXB0aW9uIjoiTmV0d29ya3M6IEhhdGVuYSwgRG91YmFuLCBUZW5jZW50IFFRLCBOYXZlciwgUmVucmVuIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2ItZXh0ZW5kZWQtYnV0dG9ucy1wYWNrIiwiZGVtb191cmwiOiJodHRwczpcL1wvc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLzUwLXNvY2lhbC1uZXR3b3Jrcy1zcGVjaWFsLWJ1dHRvbnNcLyIsImNoZWNrIjoiRVNTQl9FUF9ST09UIiwidGFncyI6Im5ldyIsImNhdGVnb3J5Ijoic29jaWFsIG5ldHdvcmtzIiwicmVxdWlyZXMiOiI0LjEuOCIsImZpbHRlcnMiOiJuZXR3b3JrcyxmcmVlIn0sImVzc2ItZnVuY3Rpb25hbC1idXR0b25zLXBhY2siOnsic2x1ZyI6ImVzc2ItZnVuY3Rpb25hbC1idXR0b25zLXBhY2siLCJuYW1lIjoiU29jaWFsIE5ldHdvcmtzOiBGdW5jdGlvbmFsIFNoYXJlIEJ1dHRvbnMgUGFjayIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wMi5wbmciLCJkZXNjcmlwdGlvbiI6IkluY2x1ZGUgdXNhZ2Ugb2YgZnVuY3Rpb25hbCBidXR0b25zIHNldDogUHJldmlvdXMgUG9zdCwgTmV4dCBQb3N0LCBDb3B5IExpbmssIEJvb2ttYXJrLCBRUiBDb2RlIEdlbmVyYXRvciIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWZ1bmNpdG9uYWwtYnV0dG9ucy1wYWNrIiwiZGVtb191cmwiOiJodHRwczpcL1wvc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLzUwLXNvY2lhbC1uZXR3b3Jrcy1zcGVjaWFsLWJ1dHRvbnNcLyIsImNoZWNrIjoiRVNTQl9GUF9ST09UIiwidGFncyI6Im5ldyIsImNhdGVnb3J5Ijoic29jaWFsIG5ldHdvcmtzIiwicmVxdWlyZXMiOiI0LjEuOCIsImZpbHRlcnMiOiJuZXR3b3JrcyxmcmVlIn0sImVzc2Itb3B0aW4tZmx5b3V0Ijp7InNsdWciOiJlc3NiLW9wdGluLWZseW91dCIsIm5hbWUiOiJPcHQtaW4gRmx5b3V0IEFkZC1vbiBmb3IgRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wNC5wbmciLCJkZXNjcmlwdGlvbiI6IkRpc3BsYXkgZmx5b3V0IG9wdC1pbiBmb3JtcyBiYXNlZCBvbiB2YXJpb3VzIGNvbmRpdGlvbnM6IHRpbWUgZGVsYXksIHNjcm9sbCBvciBleGl0IGludGVudCBhbmQgaW5jcmVhc2UgeW91ciBzdWJzY3JpYmVycy4iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1vcHRpbi1mbHlvdXQiLCJkZW1vX3VybCI6IiIsImNoZWNrIjoiRVNTQjNfT0ZPRl9WRVJTSU9OIiwidGFncyI6Im5ldyIsImNhdGVnb3J5Ijoic3Vic2NyaWJlIGV4dGVuc2lvbiIsInJlcXVpcmVzIjoiNC4wLjMiLCJmaWx0ZXJzIjoic3Vic2NyaWJlLGZyZWUifSwiZXNzYi1iZWF2ZXJidWlsZGVyLXRoZW1lLWludGVncmF0aW9uIjp7InNsdWciOiJlc3NiLWJlYXZlcmJ1aWxkZXItdGhlbWUtaW50ZWdyYXRpb24iLCJuYW1lIjoiRGlzcGxheSBNZXRob2Q6IEJlYXZlciBCdWlsZGVyIFRoZW1lIEludGVncmF0aW9uIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9leHRlbnNpb25zLTA2LnBuZyIsImRlc2NyaXB0aW9uIjoiQ3VzdG9tIGRpc3BsYXkgcG9zaXRpb25zIGZvciBCZWF2ZXIgQnVpbGRlciBUaGVtZTogQmVmb3JlXC9BZnRlciBjb250ZW50IiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2ItYmVhdmVyYnVpbGRlci10aGVtZS1pbnRlZ3JhdGlvbiIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCX0JCVF9DVVNUT01fQk9JTEVSUExBVEUiLCJ0YWdzIjoibmV3IiwiY2F0ZWdvcnkiOiJpbnRlZ3JhdGlvbiIsInJlcXVpcmVzIjoiNC4wLjIiLCJmaWx0ZXJzIjoiZGlzcGxheSxpbnRlZ3JhdGlvbixmcmVlIn0sImVzc2ItdmlkZW8tc2hhcmUtZXZlbnRzIjp7InNsdWciOiJlc3NiLXZpZGVvLXNoYXJlLWV2ZW50cyIsIm5hbWUiOiJWaWRlbyBTaGFyaW5nIEFkZC1vbiBmb3IgRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvYWRkb25faW1hZ2VzNC0xMS5wbmciLCJkZXNjcmlwdGlvbiI6IkEgbXVzdCBoYXZlIHRvb2wgZm9yIGVhY2ggdmlkZW8gbWFya2V0aW5nIGNhbXBhaWduLiBBZGQgYmVhdXRpZnVsIGNhbGwgdG8gYWN0aW9ucyBvbiBzcGVjaWZpYyBldmVudHMgdG8gaW5jcmVhc2UgeW91ciBzb2NpYWwgc2hhcmVzLCBzb2NpYWwgZm9sbG93aW5nLCBtYWlsaW5nIGxpc3QsIHlvdXIgbWFya2V0aW5nIG1lc3NhZ2UgYXQgdGhlIHJpZ2h0IHRpbWUgb3IganVzdCBzaGFyZSBidXR0b25zLiIsInByaWNlIjoiJDE0IiwicGFnZSI6Imh0dHBzOlwvXC9jb2RlY2FueW9uLm5ldFwvaXRlbVwvdmlkZW8tc2hhcmluZy1hZGRvbi1mb3ItZWFzeS1zb2NpYWwtc2hhcmUtYnV0dG9uc1wvODQzNDQ2NyIsImRlbW9fdXJsIjoiaHR0cDpcL1wvcHJldmlldy5jb2RlY2FueW9uLm5ldFwvaXRlbVwvdmlkZW8tc2hhcmluZy1hZGRvbi1mb3ItZWFzeS1zb2NpYWwtc2hhcmUtYnV0dG9uc1wvZnVsbF9zY3JlZW5fcHJldmlld1wvODQzNDQ2NyIsImNoZWNrIjoiRVNTQjNfVlNFX1ZFUlNJT04iLCJ0YWdzIjoiIiwiY2F0ZWdvcnkiOiJ2aWRlbyBzaGFyaW5nIiwicmVxdWlyZXMiOiI0LjAiLCJmaWx0ZXJzIjoidmlkZW8sZnVuY3Rpb24scGFpZCJ9LCJlc3NiLW9wdGluLWJvb3N0ZXIiOnsic2x1ZyI6ImVzc2Itb3B0aW4tYm9vc3RlciIsIm5hbWUiOiJPcHQtaW4gQm9vc3RlciBBZGQtb24gZm9yIEVhc3kgU29jaWFsIFNoYXJlIEJ1dHRvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2V4dGVuc2lvbnMtMDQucG5nIiwiZGVzY3JpcHRpb24iOiJEaXNwbGF5IG9wdC1pbiBmb3JtcyBiYXNlZCBvbiB2YXJpb3VzIGNvbmRpdGlvbnM6IHRpbWUgZGVsYXksIHNjcm9sbCBvciBleGl0IGludGVudCBhbmQgaW5jcmVhc2UgeW91ciBzdWJzY3JpYmVycy4iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1vcHRpbi1ib29zdGVyIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0IzX09GT0JfVkVSU0lPTiIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6InN1YnNjcmliZSBleHRlbnNpb24iLCJyZXF1aXJlcyI6IjQuMC4zIiwiZmlsdGVycyI6InN1YnNjcmliZSxmcmVlIn0sImVzc2ItdGVtcGxhdGUtY2hyaXN0bWFzIjp7InNsdWciOiJlc3NiLXRlbXBsYXRlLWNocmlzdG1hcyIsIm5hbWUiOiJUZW1wbGF0ZXM6IENocmlzdG1hcyBwYWNrIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9leHRlbnNpb25zLTAxLnBuZyIsImRlc2NyaXB0aW9uIjoiUHJlcGFyZSB5b3VyIHNpdGUgZm9yIHVwY29taW5nIENocmlzdG1hcyBhbmQgTmV3IFllYXIgd2l0aCB0d28gc3BlY2lhbCBDaHJpc3RtYXMgdGVtcGxhdGVzIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2ItdGVtcGxhdGUtY2hyaXN0bWFzIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0JfVEVNUExBVEVQQUNLX0NIUklTVE1BUyIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6InRlbXBsYXRlcyIsInJlcXVpcmVzIjoiNC4wLjIiLCJmaWx0ZXJzIjoidGVtcGxhdGUsZnJlZSJ9LCJlc3NiLWRpc3BsYXktd29vY29tbWVyY2ViYXIiOnsic2x1ZyI6ImVzc2ItZGlzcGxheS13b29jb21tZXJjZWJhciIsIm5hbWUiOiJEaXNwbGF5IE1ldGhvZDogV29vQ29tbWVyY2UgQmFyIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9leHRlbnNpb25zLTAzLnBuZyIsImRlc2NyaXB0aW9uIjoiU3BlY2lhbCBkZXNpZ25lZCBzaGFyZSBiYXIgZm9yIFdvb0NvbW1lcmNlIHN0b3JlcyB3aXRoIHNoYWVyIGJ1dHRvbnMsIHByb2R1Y3QgdGl0bGVcL3ByaWNlIGFuZCBidXkgbm93IGJ1dHRvbiIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWRpc3BsYXktd29vY29tbWVyY2ViYXIiLCJkZW1vX3VybCI6Imh0dHBzOlwvXC9zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvcHJvZHVjdFwvZmx5aW5nLW5pbmphXC8/cG9zaXRpb25fZGVtbz13b29iYXIiLCJjaGVjayI6IkVTU0JfRE1fVlBfUExVR0lOX1VSTCIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6Indvb2NvbW1lcmNlIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJkaXNwbGF5LGZyZWUsd29vY29tbWVyY2UifSwiZXNzYi1kaXNwbGF5LXZpcmFscG9pbnQiOnsic2x1ZyI6ImVzc2ItZGlzcGxheS12aXJhbHBvaW50IiwibmFtZSI6IkRpc3BsYXkgTWV0aG9kOiBWaXJhbCBQb2ludCIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wMy5wbmciLCJkZXNjcmlwdGlvbiI6IlN1cGVyIGNvb2wgc2hhcmUgcG9pbnQgZGVzaWduIHdpdGggYXV0b21hdGljIHRyaWdnZXIgb24gaG92ZXIsIGV5ZSBjYXRjaGluZyBkZXNpZ24gYW5kIGFuaW1hdGlvbnMiLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LXZpcmFscG9pbnQiLCJkZW1vX3VybCI6Imh0dHBzOlwvXC9zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvMjctZGlzcGxheS1wb3NpdGlvbnNcLz9wb3NpdGlvbl9kZW1vPXZpcmFscG9pbnQiLCJjaGVjayI6IkVTU0JfRE1fVlBfUExVR0lOX1VSTCIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6ImRpc3BsYXkgbWV0aG9kIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJkaXNwbGF5LGZyZWUifSwiZXNzYi1kaXNwbGF5LXN1cGVycG9zdGZsb2F0Ijp7InNsdWciOiJlc3NiLWRpc3BsYXktc3VwZXJwb3N0ZmxvYXQiLCJuYW1lIjoiRGlzcGxheSBNZXRob2Q6IFN1cGVyIFBvc3QgRmxvYXQiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2V4dGVuc2lvbnMtMDMucG5nIiwiZGVzY3JpcHRpb24iOiJFeHRlbmRlZCB2ZXJzaW9uIG9mIHBvc3QgdmVydGljYWwgZmxvYXQgd2l0aCBjYWxsIHRvIGFjdGlvbiBtZXNzYWdlIGFuZCBkaXNwbGF5IG9mIHRvdGFsXC9jb21tZW50cyBjb3VudCIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWRpc3BsYXktc3VwZXJwb3N0ZmxvYXQiLCJkZW1vX3VybCI6Imh0dHBzOlwvXC9zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvMjctZGlzcGxheS1wb3NpdGlvbnNcLz9wb3NpdGlvbl9kZW1vPXN1cGVycG9zdGZsb2F0IiwiY2hlY2siOiJFU1NCX0RNX1NQRl9QTFVHSU5fVVJMIiwidGFncyI6IiIsImNhdGVnb3J5IjoiZGlzcGxheSBtZXRob2QiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6ImRpc3BsYXksZnJlZSJ9LCJlc3NiLWRpc3BsYXktc3VwZXJwb3N0YmFyIjp7InNsdWciOiJlc3NiLWRpc3BsYXktc3VwZXJwb3N0YmFyIiwibmFtZSI6IkRpc3BsYXkgTWV0aG9kOiBTdXBlciBQb3N0IEJhciIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wMy5wbmciLCJkZXNjcmlwdGlvbiI6IkV4dGVuZCB5b3VyIGJvdHRvbSBkaXNwbGF5IG1ldGhvZCB3aXRoIHN1cGVyIHBvc3QgYmFyLiBTdXBlciBwb3N0IGJhciBhbGxvd3MgZGlzcGxheSBvZiBwcmV2aW91c1wvbmV4dCBwb3N0IHRvby4iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LXN1cGVycG9zdGJhciIsImRlbW9fdXJsIjoiaHR0cHM6XC9cL3NvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8yNy1kaXNwbGF5LXBvc2l0aW9uc1wvP3Bvc2l0aW9uX2RlbW89c3VwZXJwb3N0YmFyIiwiY2hlY2siOiJFU1NCX0RNX1NQQl9QTFVHSU5fVVJMIiwidGFncyI6IiIsImNhdGVnb3J5IjoiZGlzcGxheSBtZXRob2QiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6ImRpc3BsYXksZnJlZSJ9LCJlc3NiLWRpc3BsYXktbW9iaWxlLXNoYXJlYmFyY3RhIjp7InNsdWciOiJlc3NiLWRpc3BsYXktbW9iaWxlLXNoYXJlYmFyY3RhIiwibmFtZSI6IkRpc3BsYXkgTWV0aG9kOiBNb2JpbGUgU2hhcmUgQmFyIHdpdGggQ2FsbCB0byBBY3Rpb24gQnV0dG9uIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9leHRlbnNpb25zLTAzLnBuZyIsImRlc2NyaXB0aW9uIjoiSW5jbHVkZSBtb2JpbGUgc2hhcmUgYmFyIHdpdGggY3VzdG9tIGNhbGwgdG8gYWN0aW9uIGJ1dHRvbiBuZXh0IHRvIHNoYXJlIGJ1dHRvbi4iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LW1vYmlsZS1zaGFyZWJhcmN0YSIsImRlbW9fdXJsIjoiaHR0cHM6XC9cL3NvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8yNy1kaXNwbGF5LXBvc2l0aW9uc1wvP3Bvc2l0aW9uX2RlbW89bW9iaWxlNyIsImNoZWNrIjoiRVNTQl9ETV9NU0JDVEFfUExVR0lOX1VSTCIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6ImRpc3BsYXkgbWV0aG9kIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJkaXNwbGF5LGZyZWUifSwiZXNzYi1zdWJzY3JpYmUtY29ubmVjdG9yLWpldHBhY2siOnsic2x1ZyI6ImVzc2Itc3Vic2NyaWJlLWNvbm5lY3Rvci1qZXRwYWNrIiwibmFtZSI6Ik9wdC1pbiBDb25uZWN0b3I6IEpldFBhY2sgU3Vic2NyaXB0aW9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wNC5wbmciLCJkZXNjcmlwdGlvbiI6IkFjdGl2YXRlIHVzYWdlIG9mIEpldFBhY2sgU3Vic2NyaXB0aW9ucyBpbiBPcHQtaW4gTW9kdWxlIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2Itc3Vic2NyaWJlLWNvbm5lY3Rvci1qZXRwYWNrIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0JfU1VCU0NSSUJFX0NPTk5FQ1RPUl9KRVRQQUNLIiwidGFncyI6IiIsImNhdGVnb3J5Ijoic3Vic2NyaWJlIGZvcm1zIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJzdWJzY3JpYmUsZnJlZSJ9LCJlc3NiLXNvY2lhbC1hYiI6eyJzbHVnIjoiZXNzYi1zb2NpYWwtYWIiLCJuYW1lIjoiU29jaWFsIEFcL0IgVmlzdWFsIFRlc3RzIEFkZC1vbiBmb3IgRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wNS5wbmciLCJkZXNjcmlwdGlvbiI6Ikl0IHdhcyBuZXZlciBiZWVuIHNvIGVhc3kgdG8gZmluZCB3aGF0IHdvcmtzIGJlc3QgZm9yIHlvdXIgc2l0ZS4gU2V0dXAgdXAgdG8gMyBkaWZmZXJlbnQgY29uZmlndXJhdGlvbnMgb2YgYnV0dG9ucyBvbiB5b3VyIHNpdGUgYW5kIHJ1biB0aGUgdGVzdHMuIFlvdSB3aWxsIHNlZSByZWFsIHRpbWUgc3RhdHMgb2Ygd2hhdCBwZXJmb3JtcyBiZXN0LiIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLXNvY2lhbC1hYiIsImRlbW9fdXJsIjoiaHR0cDpcL1wvc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cL3NvY2lhbC1hYlwvIiwiY2hlY2siOiJFU1NCM19BQl9WRVJTSU9OIiwidGFncyI6InVuaXF1ZSIsImNhdGVnb3J5IjoiZnVuY3Rpb24iLCJyZXF1aXJlcyI6IjQuMCIsImZpbHRlcnMiOiJmdW5jdGlvbixmcmVlIn0sImVzc2ItcG9zdC12aWV3cyI6eyJzbHVnIjoiZXNzYi1wb3N0LXZpZXdzIiwibmFtZSI6IlBvc3QgVmlld3MgQWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9leHRlbnNpb25zLTA1LnBuZyIsImRlc2NyaXB0aW9uIjoiVHJhY2sgYW5kIGRpc3BsYXkgcG9zdCB2aWV3c1wvcmVhZHMgd2l0aCB5b3VyIHNoYXJlIGJ1dHRvbnMgYW5kIGFsc28gZGlzcGxheSBtb3N0IHBvcHVsYXIgcG9zdHMgd2l0aCB3aWRnZXQgb3Igc2hvcnRjb2RlLiIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLXBvc3Qtdmlld3MiLCJkZW1vX3VybCI6Imh0dHA6XC9cL3NvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC92aWV3c3JlYWRzLWNvdW50ZXJcLyIsInRhZ3MiOiJwb3B1bGFyIiwiY2hlY2siOiJFU1NCM19QVl9WRVJTSU9OIiwiY2F0ZWdvcnkiOiJmdW5jdGlvbiIsInJlcXVpcmVzIjoiMy4wIiwiZmlsdGVycyI6ImZ1Y3Rpb24sZnJlZSJ9LCJlc3NiLWZhY2Vib29rLWNvbW1lbnRzIjp7InNsdWciOiJlc3NiLWZhY2Vib29rLWNvbW1lbnRzIiwibmFtZSI6IkZhY2Vib29rIENvbW1lbnRzIEFkZC1vbiBmb3IgRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wNS5wbmciLCJkZXNjcmlwdGlvbiI6IkF1dG9tYXRpY2FsbHkgaW5jbHVkZSBGYWNlYm9vayBjb21tZW50cyB0byB5b3VyIGJsb2cgd2l0aCBtb2RlcmF0aW9uIG9wdGlvbiBiZWxvdyBwb3N0cyIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWZhY2Vib29rLWNvbW1lbnRzIiwiZGVtb191cmwiOiJodHRwOlwvXC9zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvZmFjZWJvb2stY29tbWVudHNcLz9mYmNvbW1lbnRzX2RlbW89dHJ1ZSIsImNoZWNrIjoiRVNTQjNfRkNfVkVSU0lPTiIsInRhZ3MiOiJwb3B1bGFyIiwiY2F0ZWdvcnkiOiJmdW5jdGlvbiIsInJlcXVpcmVzIjoiMy4wIiwiZmlsdGVycyI6ImZ1bmN0aW9uLGZyZWUifSwiZXNzYi1hbXAtc3VwcG9ydCI6eyJzbHVnIjoiZXNzYi1hbXAtc3VwcG9ydCIsIm5hbWUiOiJBTVAgU2hhcmUgQnV0dG9ucyBBZGQtb24gZm9yIEVhc3kgU29jaWFsIFNoYXJlIEJ1dHRvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2V4dGVuc2lvbnMtMDUucG5nIiwiZGVzY3JpcHRpb24iOiJJbmNsdWRlIHNoYXJlIGJ1dHRvbnMgb24geW91ciBBTVAgcGFnZXMgaWYgeW91IHVzZSBvZmZpY2lhbCBwbHVnaW4gV29yZFByZXNzIEFNUCIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWFtcC1zdXBwb3J0IiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0IzX0FNUF9QTFVHSU5fUk9PVCIsInRhZ3MiOiJ1cGRhdGVkIiwiY2F0ZWdvcnkiOiJtb2JpbGUiLCJyZXF1aXJlcyI6IjQuMCIsImZpbHRlcnMiOiJmdW5jdGlvbixmcmVlIn0sImVzc2Itb3B0aW4tY29udGVudCI6eyJzbHVnIjoiZXNzYi1vcHRpbi1jb250ZW50IiwibmFtZSI6Ik9wdC1pbiBGb3JtcyBCZWxvdyBDb250ZW50IEFkZC1vbiBmb3IgRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvZXh0ZW5zaW9ucy0wNC5wbmciLCJkZXNjcmlwdGlvbiI6IkF1dG9tYXRpY2FsbHkgaW5jbHVkZSBvcHQtaW4gZm9ybXMgZnJvbSBFYXN5IE9wdGluIGJlbG93IHBvc3QgY29udGVudC4gRWFzeSBnZXQgbW9yZSBuZXcgc3Vic2NyaWJlcnMgdG8geW91ciBtYWlsaW5nIGxpc3QuIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2Itb3B0aW4tY29udGVudCIsImRlbW9fdXJsIjoiaHR0cDpcL1wvc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cL2Vhc3ktb3B0aW5cLyIsImNoZWNrIjoiRVNTQjNfT0ZfVkVSU0lPTiIsInRhZ3MiOiIiLCJjYXRlZ29yeSI6ImZlYXR1cmUiLCJyZXF1aXJlcyI6IjQuMCIsImZpbHRlcnMiOiJzdWJzY3JpYmUsZnJlZSJ9LCJoZWxsby1mb2xsb3dlcnMiOnsic2x1ZyI6ImhlbGxvLWZvbGxvd2VycyIsIm5hbWUiOiJIZWxsbyBGb2xsb3dlcnMgLSBTb2NpYWwgQ291bnRlciBQbHVnaW4iLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlczQtMDUucG5nIiwiZGVzY3JpcHRpb24iOiJCZWF0aWZ1bCBhbmQgdW5pcXVlIGV4dGVuc2lvbiBvZiB5b3VyIGN1cnJlbnQgc29jaWFsIGZvbGxvd2VycyB3aXRoIGNvdmVyIGJveGVzLCBsYXlvdXQgYnVpbGRlciwgYWR2YW5jZWQgY3VzdG9taXplciwgcHJvZmlsZSBhbmFseXRpY3MuIFRyeSB0aGUgbGl2ZSBkZW1vIHRvIHRlc3QuIiwicHJpY2UiOiIkMjQiLCJwYWdlIjoiaHR0cDpcL1wvY29kZWNhbnlvbi5uZXRcL2l0ZW1cL2hlbGxvLWZvbGxvd2Vycy1zb2NpYWwtY291bnRlci1wbHVnaW4tZm9yLXdvcmRwcmVzc1wvMTU4MDE3MjkiLCJkZW1vX3VybCI6Imh0dHA6XC9cL2NvZGVjYW55b24ubmV0XC9pdGVtXC9oZWxsby1mb2xsb3dlcnMtc29jaWFsLWNvdW50ZXItcGx1Z2luLWZvci13b3JkcHJlc3NcL2Z1bGxfc2NyZWVuX3ByZXZpZXdcLzE1ODAxNzI5IiwiY2hlY2siOiJIRl9WRVJTSU9OIiwiY2F0ZWdvcnkiOiJwYWlkIiwicmVxdWlyZXMiOiIxLjAiLCJmaWx0ZXJzIjoicGFpZCJ9LCJlc3NiLXNlbGYtc2hvcnQtdXJsIjp7InNsdWciOiJlc3NiLXNlbGYtc2hvcnQtdXJsIiwibmFtZSI6IlNlbGYtSG9zdGVkIFNob3J0IFVSTHMgYWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXM0LTAxLnBuZyIsImRlc2NyaXB0aW9uIjoiR2VuZXJhdGUgc2VsZiBob3N0ZWQgc2hvcnQgVVJMcyBkaXJlY3RseSBmcm9tIHlvdXIgV29yZFByZXNzIHdpdGhvdXQgZXh0ZXJuYWwgc2VydmljZXMgbGlrZSBodHRwOlwvXC9kb21haW4uY29tXC9heFdzYSBvciBjdXN0b20gYmFzZWQgaHR0cDpcL1wvZG9tYWluLmNvbVwvZXNzYi4iLCJwcmljZSI6IiQxNCIsInBhZ2UiOiJodHRwOlwvXC9jb2RlY2FueW9uLm5ldFwvaXRlbVwvc2VsZi1ob3N0ZWQtc2hvcnQtdXJscy1hZGRvbi1mb3ItZWFzeS1zb2NpYWwtc2hhcmUtYnV0dG9uc1wvMTUwNjY0NDciLCJkZW1vX3VybCI6Imh0dHA6XC9cL2NvZGVjYW55b24ubmV0XC9pdGVtXC9zZWxmLWhvc3RlZC1zaG9ydC11cmxzLWFkZG9uLWZvci1lYXN5LXNvY2lhbC1zaGFyZS1idXR0b25zXC9mdWxsX3NjcmVlbl9wcmV2aWV3XC8xNTA2NjQ0NyIsImNoZWNrIjoiRVNTQjNfU1NVX1ZFUlNJT04iLCJjYXRlZ29yeSI6InBhaWQiLCJyZXF1aXJlcyI6IjMuMS4yIiwiZmlsdGVycyI6ImZ1bmN0aW9uLHBhaWQifSwiZmlsdGVycyI6eyJhbGwiOiJBbGwiLCJuZXciOiJOZXciLCJmcmVlIjoiRnJlZSIsIm5ldHdvcmtzIjoiTmV0d29ya3MiLCJkaXNwbGF5IjoiRGlzcGxheSBNZXRob2RzIiwidGVtcGxhdGUiOiJUZW1wbGF0ZXMiLCJzdWJzY3JpYmUiOiJTdWJzY3JpYmUgRm9ybXMiLCJ2aWRlbyI6IlZpZGVvIFNoYXJpbmciLCJmdW5jdGlvbiI6IkZ1bmN0aW9ucyIsInBhaWQiOiJQYWlkIiwiaW50ZWdyYXRpb24iOiJJbnRlZ3JhdGlvbiIsIndvb2NvbW1lcmNlIjoiV29vQ29tbWVyY2UifX0=';
	private $base_addons_data;
	private $version5_exclude = array('essb-optin-flyout', 'essb-optin-booster', 'essb-optin-content', 'essb-amp-support');

	private static $instance = null;
	public static function get_instance() {

		if ( null == self::$instance ) {
			self::$instance = new self;
		}

		return self::$instance;

	} // end get_instance;

	function __construct() {
		$remote_result = base64_decode ( $this->base_addons );
		
		$remote_result = htmlspecialchars_decode ( $remote_result );
		$remote_result = stripslashes ( $remote_result );
		$info = json_decode($remote_result, true);
		if (is_array($info)) {
			//update_option($this->cache_options_slug, $info);
			$this->base_addons_data = $info;
		}
	}


	public function call_remove_addon_list_update() {		
		$url = $this->update_addons_server;
		$result = wp_remote_get($url);
		$success_connection = true;

		if(is_wp_error($result) or (wp_remote_retrieve_response_code($result) != 200)){
			$success_connection = false;
		}
			
		/* Check for incorrect data */
		if ($success_connection) {
			$remote_result = wp_remote_retrieve_body($result);
			$remote_result = base64_decode ( $remote_result );
		
			$remote_result = htmlspecialchars_decode ( $remote_result );
			$remote_result = stripslashes ( $remote_result );						
			
			$info = json_decode($remote_result, true);
			if (is_array($info)) {
				update_option($this->cache_options_slug, $info);
			}
		}
	}

	public function get_addons() {
		$addons = get_option($this->cache_options_slug);

		//if (!$addons) {
			$addons = $this->base_addons_data;
		//}
		
		if (!is_array($addons)) {
			$addons = array();
		}
		
		$r = array();
		
		foreach ($addons as $key => $data) {
			if (!in_array($key, $this->version5_exclude)) {
				$r[$key] = $data;
			}
		}
		
		return $r;
	}

	public function get_new_addons() {
		/*if (false === get_transient($this->cache_options_slug)) {
			$this->call_remove_addon_list_update();
			delete_transient($this->cache_options_slug);
			set_transient( $this->cache_options_slug, 'updated', 168 * HOUR_IN_SECONDS );
		}*/

		$addons = $this->get_addons();

		if (!is_array($addons)) {
			$addons = array();
		}

		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		$list_of_new = array();
		foreach ($addons as $addon_key => $addon_data) {
			if ($addon_key == "filters") continue;
			
			if (in_array($addon_key, $this->version5_exclude)) continue;
			if (!isset($current_announced[$addon_key])) {
				$list_of_new[$addon_key] = array("title" => $addon_data['name'], "url" => $addon_data['page']);
			}
		}


		return $list_of_new;
	}

	public function get_new_addons_count() {
		/*if (false === get_transient($this->cache_options_slug)) {
			$this->call_remove_addon_list_update();
			delete_transient($this->cache_options_slug);
			set_transient( $this->cache_options_slug, 'updated', 168 * HOUR_IN_SECONDS );
		}*/

		$addons = $this->get_addons();

		if (!is_array($addons)) {
			$addons = array();
		}

		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		$list_of_new = 0;
		foreach ($addons as $addon_key => $addon_data) {
			if ($addon_key == "filters") continue;
			if (in_array($addon_key, $this->version5_exclude)) continue;
			if (!isset($current_announced[$addon_key])) {
				$list_of_new++;
			}
		}


		return $list_of_new;
	}

	public function dismiss_addon_notice($addon) {
		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		if (strpos($addon, ',') == false) {
			$current_announced[$addon] = "yes";
		}
		else {
			$addon_list = explode(',', $addon);
			foreach ($addon_list as $one) {
				$current_announced[$one] = "yes";
			}
		}

		update_option($this->announced_addons_slug, $current_announced);
	}
}

?>